<!DOCTYPE html>
<html lang="en">
    <%- include('partials/head', {title: `Yuna | ${folder.name}`, cssPath: ''}) %>
    <body>
        <% if (authenticated) { %>
        <form action="" method="post">
            <input type="text" name="name" />
            <input type="hidden" name="id" value="<%= folder.id %>" />
            <button>SUBMIT</button>
        </form>
        <form action="/files" method="post" enctype="multipart/form-data">
            <input type="file" name="file" onchange="checkSize(this)" />
            <input type="hidden" name="folder" value="<%= folder.id %>" />
            <button>submit</button>
        </form>
        <%}%>
        <!---->
        <div class="folderFileContainer">
            <% if (folder.parentFolderId) { %>
            <a href="/folders/<%= folder.parentFolderId  %>"><%= folder.parentFolder.name %></a>
            <%}%>
            <a href="/folders/<%= folder.id %>"><%= folder.name %></a>
            <h1><%= folder.name %></h1>
            <% folder.subFolders.forEach((folder, index) => {%>
            <!---->
            <%- include('partials/folderFileContainer', {link: `/folders/${folder.id}`, name: folder.name, date: folder.date, size: 'X', btnClass:
            `folder-${index}`, id: folder.id}) %>
            <!---->
            <% }) %>
            <!---->
            <% folder.files.forEach((file, index) => { %>
            <!---->
            <%- include('partials/folderFileContainer', {link: `/files/${file.id}`, name: file.name, size: file.size, date: file.date, btnClass:
            `file-${index}`, id: file.id}) %>
            <!---->
            <% }) %> <%- include('partials/shareFolderDiv') %>
        </div>
    </body>
    <script>
        function checkSize(input) {
            const UPLOAD_LIMIT = 50 * 1000000;
            const file = input.files[0];

            if (file.size > UPLOAD_LIMIT) {
                alert("File can't be larger than 50MB");

                input.value = null;
            }
        }
        // Show delete / rename stuff when button is pressed
        const folderFileDiv = document.querySelector(".folderFileContainer");

        folderFileDiv.addEventListener("click", e => {
            const [isModifyBtn, divIndex] = e.target.classList;

            if (isModifyBtn !== "modify-btn") return;

            const modifyDiv = document.querySelector(`div.${divIndex}`);
            const modifyDivs = document.querySelectorAll(".modify-div"); // only display one modify div at a time
            const modifyDivDisplay = modifyDiv.style.display;

            modifyDivs.forEach(div => {
                div.style.display = "none";
            });

            modifyDiv.style.display = modifyDivDisplay === "none" ? "flex" : "none";
        });
    </script>
</html>
