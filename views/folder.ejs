<!DOCTYPE html>
<html lang="en">
    <%- include('partials/head', {title: `Yuna | ${folder.name}`, cssPath: ''}) %>
    <body>
        <% if (authenticated) { %>
        <button class="folder-btn">New Folder</button>
        <button class="file-btn">New File</button>
        <%}%>
        <!---->
        <div class="folderFileContainer">
            <% if (folder.parentFolderId) { %>
            <a href="/folders/<%= folder.parentFolderId  %>"><%= folder.parentFolder.name %></a>
            <%}%>
            <a href="/folders/<%= folder.id %>"><%= folder.name %></a>
            <h1><%= folder.name %></h1>
            <% folder.subFolders.forEach((folder, index) => {%>
            <!---->
            <%- include('partials/folderFileContainer', {link: `/folders/${folder.id}`, name: folder.name, date: folder.date, size: 'X', btnClass:
            `folder-${index}`, id: folder.id}) %>
            <!---->
            <% }) %>
            <!---->
            <% folder.files.forEach((file, index) => { %>
            <!---->
            <%- include('partials/folderFileContainer', {link: `/files/${file.id}`, name: file.name, size: file.size, date: file.date, btnClass:
            `file-${index}`, id: file.id}) %>
            <!---->
            <% }) %>
            <!---->
            <button class="share-btn">SHARE FOLDER</button>
        </div>
    </body>
    <!--DIALOGS-->
    <%-include('partials/folderDialog', {id: folder.id}) %>
    <!---->
    <%- include('partials/fileDialog', {id: folder.id}) %>
    <!---->
    <%- include('partials/shareDialog', {id: folder.id}) %>
    <script>
        function checkSize(input) {
            const UPLOAD_LIMIT = 50 * 1000000;
            const file = input.files[0];

            if (file.size > UPLOAD_LIMIT) {
                alert("File can't be larger than 50MB");

                input.value = null;
            }
        }
        // Show delete / rename stuff when button is pressed
        const folderFileDiv = document.querySelector(".folderFileContainer");
        const folderBtn = document.querySelector(".folder-btn");
        const fileBtn = document.querySelector(".file-btn");
        const renameBtn = document.querySelectorAll(".rename-btn");
        const deleteBtn = document.querySelectorAll(".delete-btn");
        const shareBtn = document.querySelector(".share-btn");
        const folderDialog = document.querySelector(".folder-dialog");
        const fileDialog = document.querySelector(".file-dialog");
        const renameDialog = document.querySelectorAll(".rename-dialog");
        const deleteDialog = document.querySelectorAll(".delete-dialog");
        const shareDialog = document.querySelector(".share-dialog");
        const closeDialogBtn = document.querySelectorAll(".close-dialog-btn");

        folderFileDiv.addEventListener("click", e => {
            const [isModifyBtn, divIndex] = e.target.classList;

            if (isModifyBtn !== "modify-btn") return;

            const modifyDiv = document.querySelector(`div.${divIndex}`);
            const modifyDivs = document.querySelectorAll(".modify-div"); // only display one modify div at a time
            const modifyDivDisplay = modifyDiv.style.display;

            modifyDivs.forEach(div => {
                div.style.display = "none";
            });

            modifyDiv.style.display = modifyDivDisplay === "none" ? "flex" : "none";
        });

        folderBtn.addEventListener("click", () => folderDialog.showModal());
        fileBtn.addEventListener("click", () => fileDialog.showModal());
        shareBtn.addEventListener("click", () => shareDialog.showModal());
        renameBtn.forEach(btn => {
            const id = btn.classList[1];
            const renameDialog = document.getElementsByClassName(`rename-dialog ${id}`)[0];
            console.log({ id, renameDialog });

            btn.addEventListener("click", () => renameDialog.showModal());
        });
        deleteBtn.forEach(btn => {
            const id = btn.classList[1];
            const deleteDialog = document.getElementsByClassName(`delete-dialog ${id}`)[0];

            btn.addEventListener("click", () => deleteDialog.showModal());
        });

        closeDialogBtn.forEach(btn => {
            btn.addEventListener("click", () => {
                folderDialog.close();
                fileDialog.close();
                shareDialog.close();
                renameDialog.forEach(dialog => dialog.close());
                deleteDialog.forEach(dialog => dialog.close());
            });
        });
    </script>
</html>
